// datable.js by invot
// version 0.2.2

!function(e){e.fn.datable=function(){function t(e,t){for(var a={},n=0;n<e.length;n++)a[e[n]]=t[n];return a}function a(e,t,a){var n=new Date(e,t-1,a);return n.getFullYear()==e&&n.getMonth()==t-1&&n.getDate()==a?!0:!1}e(this).each(function(){var n=e(this),r=n.data("datable"),l=n.data("datable-start"),o=n.data("datable-era"),s=r.match(/.{2}/g),d=[],v=n.data("datable-divider"),i=v?v:" / ";e.each(s,function(t,a){-1===e.inArray(a,d)?d.push(a):(d.pop(),d.push(a+a))});var g=d.join(i).toUpperCase();if(n.attr("maxlength",g.length),n.attr("placeholder",g).val(),n.on("keydown",function(t){if((t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&-1===e.inArray(t.keyCode,[46,8,9,27,13])&&t.preventDefault(),8==t.keyCode)-1!=n.val().indexOf(i,n.val().length-i.length)&&(console.log("divider removed"),n.val(n.val().replace(new RegExp(i+"$"),"")),t.preventDefault());else{var a=this.selectionStart,r=n.val().length;r!==g.length&&(r==d[0].length?n.val(n.val()+i):r==d[0].length+d[1].length+i.length&&n.val(n.val()+i)),a!==r&&n.val(n.val().substring(0,r))}}),o){var y,h;y=l?new Date(l):new Date;var p=o.split(","),c=parseInt(y.getDate())+parseInt(p[2]),u=parseInt(y.getMonth())+parseInt(p[1]),f=parseInt(y.getFullYear())+parseInt(p[0]);h=new Date(f,u,c)}n.on("blur",function(){var e=n.val().split(i),r=t(d,e),l=0;if(r.yy&&(r.yyyy=2e3+parseInt(r.yy)),r.dd||(r.dd=1),a(r.yyyy,r.mm,r.dd)){console.log("it's a date!");var s=new Date(r.yyyy,r.mm,r.dd);console.log("tv:"+s.toString()),o&&(s>y&&s>=h?l++:y>s&&h>=s&&l++)}else l++;0!==n.val().length&&l?n.addClass("error").closest(".control-group").addClass("has-error"):n.removeClass("error").closest(".control-group").removeClass("has-error")})})}}(jQuery);
