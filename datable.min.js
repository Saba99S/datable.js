// datable.js by invot
// version 0.2.1

!function(e){e.fn.datable=function(){function t(e,t){for(var a={},n=0;n<e.length;n++)a[e[n]]=t[n];return a}function a(e,t,a){var n=new Date(e,t-1,a);return n.getFullYear()==e&&n.getMonth()==t-1&&n.getDate()==a?!0:!1}e(this).each(function(){var n=e(this),l=n.data("datable"),r=n.data("datable-start"),o=n.data("datable-era"),s=l.match(/.{2}/g),d=[],y=n.data("datable-divider"),g=y?y:" / ";e.each(s,function(t,a){-1===e.inArray(a,d)?d.push(a):(d.pop(),d.push(a+a))});var v=d.join(g).toUpperCase();if(n.attr("maxlength",v.length),n.attr("placeholder",v).val(),n.on("keydown",function(t){if((t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&-1===e.inArray(t.keyCode,[46,8,9,27,13])&&t.preventDefault(),8==t.keyCode)n.val().indexOf(g,n.val().length-g.length)&&(n.val(n.val().replace(new RegExp(g+"$"),"")),t.preventDefault());else{var a=this.selectionStart,l=n.val().length;l!==v.length&&(l==d[0].length?n.val(n.val()+g):l==d[0].length+d[1].length+g.length&&n.val(n.val()+g)),a!==l&&n.val(n.val().substring(0,l))}}),o){var i,h;i=r?new Date(r):new Date;var c=o.split(","),p=parseInt(i.getDate())+parseInt(c[2]),u=parseInt(i.getMonth())+parseInt(c[1]),f=parseInt(i.getFullYear())+parseInt(c[0]);h=new Date(f,u,p)}n.on("blur",function(){var e=n.val().split(g),l=t(d,e),r=0;if(l.yy&&(l.yyyy=2e3+parseInt(l.yy)),l.dd||(l.dd=1),console.log(l.dd),console.log(l.mm),console.log(l.yyyy),a(l.yyyy,l.mm,l.dd)){console.log("it's a date!");var s=new Date(l.yyyy,l.mm,l.dd);console.log("tv:"+s.toString()),o&&(s>i&&s>=h?r++:i>s&&h>=s&&r++)}else r++;0!==n.val().length&&r?n.addClass("error").closest(".control-group").addClass("has-error"):n.removeClass("error").closest(".control-group").removeClass("has-error")})})}}(jQuery);
