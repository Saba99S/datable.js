// datable.js by invot
// version 0.3.1

!function(e){e.fn.datable=function(){function a(e,a){for(var t={},r=0;r<e.length;r++)t[e[r]]=a[r];return t}function t(e,a,t){var r=new Date(e,a-1,t);return r.getFullYear()==e&&r.getMonth()==a-1&&r.getDate()==t?!0:!1}function r(e,a){for(var t=[],r=-1;(r=a.indexOf(e,r+1))>=0;)t.push(r);return t}e(this).each(function(){var n=e(this),l=n.data("datable"),o=n.data("datable-start"),s=n.data("datable-era"),d=l.match(/.{2}/g),i=[],y=n.data("datable-divider"),v=y?y:" / ";e.each(d,function(a,t){-1===e.inArray(t,i)?i.push(t):(i.pop(),i.push(t+t))});var h=i.join(v).toUpperCase();if(n.attr("maxlength",h.length),n.attr("placeholder",h).val(),n.on("keydown",function(a){if((a.shiftKey||a.keyCode<48||a.keyCode>57)&&(a.keyCode<96||a.keyCode>105)&&-1===e.inArray(a.keyCode,[46,8,9,27,13,37,39])&&a.preventDefault(),8==a.keyCode)-1!==n.val().indexOf(v,n.val().length-v.length)&&(n.val(n.val().replace(new RegExp(v+"$"),"")),a.preventDefault());else if(a.keyCode>36&&a.keyCode<41);else{var t=this.selectionStart,l=(n.val().length,r(v,h)),o=n.val().substring(t,parseInt(t)+v.length);console.log(l),o!=v||e.inArray(t,l)?-1!==e.inArray(t,l)&&n.val().length<h.length&&n.val(n.val()+v):this.selectionStart=n.val().length}}),s){var p,u;p=o?new Date(o):new Date;var g=s.split(","),c=parseInt(p.getDate())+parseInt(g[2]),f=parseInt(p.getMonth())+parseInt(g[1]),C=parseInt(p.getFullYear())+parseInt(g[0]);u=new Date(C,f,c)}n.on("blur",function(){var e=n.val().split(v),r=a(i,e),l=0;if(r.yy&&(r.yyyy=2e3+parseInt(r.yy)),r.dd||(r.dd=1),r.mm||(r.mm=1),t(r.yyyy,r.mm,r.dd)){var o=new Date(r.yyyy,r.mm,r.dd);s&&(o>p&&o>=u?l++:p>o&&u>=o&&l++)}else l++;0!==n.val().length&&l?n.addClass("error").closest(".control-group").addClass("has-error"):n.removeClass("error").closest(".control-group").removeClass("has-error")})})}}(jQuery);
