// datable.js by invot
// version 0.2.0

function toObject(e,t){for(var a={},n=0;n<e.length;n++)a[e[n]]=t[n];return a}function isDate(e,t,a){var n=new Date(e,t-1,a);return n.getFullYear()==e&&n.getMonth()==t-1&&n.getDate()==a?!0:!1}String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var a=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>a.length)&&(t=a.length),t-=e.length;var n=a.indexOf(e,t);return-1!==n&&n===t}),function(e){e.fn.datable=function(){e(this).each(function(){var t=e(this),a=t.data("datable"),n=t.data("datable-start"),r=t.data("datable-era"),o=a.match(/.{2}/g),l=[],s=t.data("datable-divider"),i=s?s:" / ";e.each(o,function(t,a){-1===e.inArray(a,l)?l.push(a):(l.pop(),l.push(a+a))});var d=l.join(i).toUpperCase();if(t.attr("maxlength",d.length),t.attr("placeholder",d).val(),t.on("keydown",function(a){if((a.shiftKey||a.keyCode<48||a.keyCode>57)&&(a.keyCode<96||a.keyCode>105)&&-1===e.inArray(a.keyCode,[46,8,9,27,13])&&a.preventDefault(),8==a.keyCode)t.val().endsWith(i)&&(t.val(t.val().replace(new RegExp(i+"$"),"")),a.preventDefault());else{var n=this.selectionStart,r=t.val().length;r!==d.length&&(r==l[0].length?t.val(t.val()+i):r==l[0].length+l[1].length+i.length&&t.val(t.val()+i)),n!==r&&t.val(t.val().substring(0,r))}}),r){var y,g;y=n?new Date(n):new Date;var h=r.split(","),v=parseInt(y.getDate())+parseInt(h[2]),p=parseInt(y.getMonth())+parseInt(h[1]),c=parseInt(y.getFullYear())+parseInt(h[0]);g=new Date(c,p,v)}t.on("blur",function(){var e=t.val().split(i),a=toObject(l,e),n=0;if(a.yy&&(a.yyyy=2e3+parseInt(a.yy)),a.dd||(a.dd=1),console.log(a.dd),console.log(a.mm),console.log(a.yyyy),isDate(a.yyyy,a.mm,a.dd)){console.log("it's a date!");var o=new Date(a.yyyy,a.mm,a.dd);console.log("tv:"+o.toString()),r&&(o>y&&o>=g?n++:y>o&&g>=o&&n++)}else n++;0!==t.val().length&&n?t.addClass("error").closest(".control-group").addClass("has-error"):t.removeClass("error").closest(".control-group").removeClass("has-error")})})}}(jQuery);
