// datable.js by invot
// version 0.3.0

!function(e){e.fn.datable=function(){function t(e,t){for(var a={},r=0;r<e.length;r++)a[e[r]]=t[r];return a}function a(e,t,a){var r=new Date(e,t-1,a);return r.getFullYear()==e&&r.getMonth()==t-1&&r.getDate()==a?!0:!1}function r(e,t){for(var a=[],r=-1;(r=t.indexOf(e,r+1))>=0;)a.push(r);return a}e(this).each(function(){var n=e(this),l=n.data("datable"),o=n.data("datable-start"),s=n.data("datable-era"),d=l.match(/.{2}/g),i=[],y=n.data("datable-divider"),v=y?y:" / ";e.each(d,function(t,a){-1===e.inArray(a,i)?i.push(a):(i.pop(),i.push(a+a))});var h=i.join(v).toUpperCase();if(n.attr("maxlength",h.length),n.attr("placeholder",h).val(),n.on("keydown",function(t){if((t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&-1===e.inArray(t.keyCode,[46,8,9,27,13,37,39])&&t.preventDefault(),8==t.keyCode)-1!==n.val().indexOf(v,n.val().length-v.length)&&(n.val(n.val().replace(new RegExp(v+"$"),"")),t.preventDefault());else if(t.keyCode>36&&t.keyCode<41);else{var a=this.selectionStart,l=(n.val().length,r(v,h)),o=n.val().substring(a,parseInt(a)+v.length);o==v?this.selectionStart=n.val().length:-1!==e.inArray(a,l)&&n.val().length<h.length&&n.val(n.val()+v)}}),s){var p,u;p=o?new Date(o):new Date;var g=s.split(","),f=parseInt(p.getDate())+parseInt(g[2]),c=parseInt(p.getMonth())+parseInt(g[1]),C=parseInt(p.getFullYear())+parseInt(g[0]);u=new Date(C,c,f)}n.on("blur",function(){var e=n.val().split(v),r=t(i,e),l=0;if(r.yy&&(r.yyyy=2e3+parseInt(r.yy)),r.dd||(r.dd=1),r.mm||(r.mm=1),a(r.yyyy,r.mm,r.dd)){var o=new Date(r.yyyy,r.mm,r.dd);s&&(o>p&&o>=u?l++:p>o&&u>=o&&l++)}else l++;0!==n.val().length&&l?n.addClass("error").closest(".control-group").addClass("has-error"):n.removeClass("error").closest(".control-group").removeClass("has-error")})})}}(jQuery);
