// datable.js by invot
// version 0.2.2

!function(e){e.fn.datable=function(){function a(e,a){for(var t={},n=0;n<e.length;n++)t[e[n]]=a[n];return t}function t(e,a,t){var n=new Date(e,a-1,t);return n.getFullYear()==e&&n.getMonth()==a-1&&n.getDate()==t?!0:!1}e(this).each(function(){var n=e(this),r=n.data("datable"),l=n.data("datable-start"),o=n.data("datable-era"),s=r.match(/.{2}/g),d=[],v=n.data("datable-divider"),y=v?v:" / ";e.each(s,function(a,t){-1===e.inArray(t,d)?d.push(t):(d.pop(),d.push(t+t))});var h=d.join(y).toUpperCase();if(n.attr("maxlength",h.length),n.attr("placeholder",h).val(),n.on("keydown",function(a){if((a.shiftKey||a.keyCode<48||a.keyCode>57)&&(a.keyCode<96||a.keyCode>105)&&-1===e.inArray(a.keyCode,[46,8,9,27,13])&&a.preventDefault(),8==a.keyCode)-1!=n.val().indexOf(y,n.val().length-y.length)&&(n.val(n.val().replace(new RegExp(y+"$"),"")),a.preventDefault());else{var t=this.selectionStart,r=n.val().length;r!==h.length&&(r==d[0].length?n.val(n.val()+y):r==d[0].length+d[1].length+y.length&&n.val(n.val()+y)),t!==r&&n.val(n.val().substring(0,r))}}),o){var i,g;i=l?new Date(l):new Date;var p=o.split(","),u=parseInt(i.getDate())+parseInt(p[2]),c=parseInt(i.getMonth())+parseInt(p[1]),f=parseInt(i.getFullYear())+parseInt(p[0]);g=new Date(f,c,u)}n.on("blur",function(){var e=n.val().split(y),r=a(d,e),l=0;if(r.yy&&(r.yyyy=2e3+parseInt(r.yy)),r.dd||(r.dd=1),t(r.yyyy,r.mm,r.dd)){var s=new Date(r.yyyy,r.mm,r.dd);o&&(s>i&&s>=g?l++:i>s&&g>=s&&l++)}else l++;0!==n.val().length&&l?n.addClass("error").closest(".control-group").addClass("has-error"):n.removeClass("error").closest(".control-group").removeClass("has-error")})})}}(jQuery);
