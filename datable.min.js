// datable.js by invot
// version 0.1.5

function toObject(e,t){for(var a={},r=0;r<e.length;r++)a[e[r]]=t[r];return a}String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var a=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>a.length)&&(t=a.length),t-=e.length;var r=a.indexOf(e,t);return-1!==r&&r===t}),function(e){e.fn.datable=function(){e(this).each(function(){var t=e(this),a=t.data("datable"),r=t.data("datable-start"),n=t.data("datable-era"),l=a.match(/.{2}/g),o=[],i=t.data("datable-divider"),s=i?i:" / ";e.each(l,function(t,a){-1===e.inArray(a,o)?o.push(a):(o.pop(),o.push(a+a))});var d=o.join(s).toUpperCase();if(t.attr("maxlength",d.length),t.attr("placeholder",d).val(),t.on("keydown",function(a){if((a.shiftKey||a.keyCode<48||a.keyCode>57)&&(a.keyCode<96||a.keyCode>105)&&-1===e.inArray(a.keyCode,[46,8,9,27,13,110,190])&&a.preventDefault(),8==a.keyCode)t.val().endsWith(s)&&(t.val(t.val().replace(new RegExp(s+"$"),"")),a.preventDefault());else{var r=this.selectionStart,n=t.val().length;n!==d.length&&(n==o[0].length?t.val(t.val()+s):n==o[0].length+o[1].length+s.length&&t.val(t.val()+s)),r!==n&&t.val(t.val().substring(0,n))}}),n){var h,v;if(r)h=Math.round(new Date(r.replace(",","/")).getTime()/1e3);else{var g=new Date;h=Math.round(g.getTime()/1e3),r=g.getFullYear()+","+(g.getMonth()+1)+","+g.getDate()}var p=r.split(","),y=n.split(","),u=parseInt(p[0])+parseInt(y[0])+"/"+(parseInt(p[1])+parseInt(y[1]))+"/"+(parseInt(p[2])+parseInt(y[2]));v=Math.round(new Date(u).getTime()/1e3)}t.on("blur",function(){var e=t.val().split(s),a=toObject(o,e),r=0;if((a.mm>12||a.mm<1)&&r++,(a.dd>31||a.dd<1)&&r++,(a.yyyy>3e3||a.yyyy<1e3)&&r++,n){var l=Math.round(new Date(a.yyyy+"/"+a.mm+"/"+a.dd).getTime()/1e3);isNaN(l)||(l>h&&l>=v?r++:h>l&&v>=l&&r++)}0!==t.val().length&&r?t.addClass("error").closest(".control-group").addClass("has-error"):t.removeClass("error").closest(".control-group").removeClass("has-error")})})}}(jQuery);
